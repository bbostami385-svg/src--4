<!DOCTYPE html>
<html>
<head>
  <title>Bayojid AI</title>
</head>
<body>

<h2>Login / Signup</h2>

<input type="email" id="email" placeholder="Enter Email">
<input type="password" id="password" placeholder="Enter Password">

<button onclick="signup()">Signup</button>
<button onclick="login()">Login</button>
<button onclick="logout()">Logout</button>

<p id="user-status">Not logged in</p>

<hr>

<h2>AI Chat</h2>

<input type="text" id="chat-input" placeholder="Type message">
<button onclick="sendMessage()">Send</button>

<div id="chat-box"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBYpQsXTHmvq0bvBYF2zKUrxdMEDoEs7qw",
    authDomain: "bayojidaichat.firebaseapp.com",
    projectId: "bayojidaichat",
    storageBucket: "bayojidaichat.firebasestorage.app",
    messagingSenderId: "982053349033",
    appId: "1:982053349033:web:b89d9c88b4516293bfebb8",
    measurementId: "G-NHBRHRLRQR"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  function signup() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    auth.createUserWithEmailAndPassword(email, password)
      .then(() => alert("Signup Successful ✅"))
      .catch(error => alert(error.message));
  }

  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    auth.signInWithEmailAndPassword(email, password)
      .then(() => alert("Login Successful ✅"))
      .catch(error => alert(error.message));
  }

  function logout() {
    auth.signOut();
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById("user-status").innerText =
        "Logged in as: " + user.email;
    } else {
      document.getElementById("user-status").innerText =
        "Not logged in";
    }
  });

  const API_BASE = "https://src-4-a535.onrender.com";

  function sendMessage() {
    if (!auth.currentUser) {
      alert("Please login first ❌");
      return;
    }

    const input = document.getElementById("chat-input");
    const message = input.value;
    if (!message) return;

    fetch(`${API_BASE}/chat`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById("chat-box").innerHTML += `
        <div><b>You:</b> ${message}</div>
        <div><b>AI:</b> ${data.reply}</div>
      `;
      input.value = "";
    });
  }
</script>

</body>
</html>
