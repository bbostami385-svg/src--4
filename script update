<script>
const chatBox = document.getElementById("chatBox")
const messageInput = document.getElementById("message")
const sendBtn = document.getElementById("sendBtn")
const API_URL = "https://src-4-a535.onrender.com/chat" // তোমার backend

sendBtn.addEventListener("click", async () => {
  const message = messageInput.value.trim()
  if (!message) return
  appendMessage("You", message)
  messageInput.value = ""

  try {
    const res = await axios.post(API_URL, { username: "free_user", message })
    const data = res.data

    if (data.reply) {
      appendMessage("AI", data.reply)
      if (data.timeLeft) {
        appendMessage("System", `Time left: ${Math.floor(data.timeLeft/60)} min`)
      }
    } else if (data.error) {
      appendMessage("System", data.error)
      // Free limit শেষ → Upgrade message
      if(data.error.includes("Upgrade")) {
        appendMessage("System", "Upgrade to Premium for unlimited chat!")
      }
    }
  } catch {
    appendMessage("System", "Error connecting to backend")
  }
})

function appendMessage(sender, text) {
  const div = document.createElement("div")
  div.innerHTML = `<strong>${sender}:</strong> ${text}`
  chatBox.appendChild(div)
}
</script>